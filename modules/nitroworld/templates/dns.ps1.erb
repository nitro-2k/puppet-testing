### Called by Puppet to check/set DNS on Windows Servers

$dnsserversERB = '<%= @dnsservers %>',
#$dnssearchERB = '<%= @dnssearch %>',
$interfaceERB = '<%= @interface %>'

if ($Interface -eq $null -or $Interface -eq '') {
    Write-Error "Interface not specified"
    exit 1
}

if ($DNSServers -eq $null -or $DNSServers -eq '') {
    Write-Error "DNS Servers not specified"
    exit 1
}

$CurrentDNS = (Get-DnsClientServerAddress | where {$_.AddressFamily -eq 2 -and $_.InterfaceAlias -eq $($Interface)}).ServerAddresses

#Write-Output "Current Settings = $($CurrentDNS -join ",")"
#Write-Output "Desired Settings = $($DNSServers -join ",")"

if ($($CurrentDNS -join ",") -ne $($DNSServers -join ",")) {
    #Write-Output "Setting DNS settings to desired"
    Set-DnsClientServerAddress -InterfaceAlias $Interface -ServerAddresses $($DNSServers -join ",")
}
